{% extends 'base.html' %}
{% block title %}NEXUS Panel{% endblock %}

<style>
/* Tab Navigation Styles */
.nav-tabs .nav-link {
    border: 1px solid #dee2e6;
    border-bottom-color: transparent;
    background-color: #f8f9fa;
    color: #495057;
    margin-right: 2px;
    border-radius: 0.375rem 0.375rem 0 0;
    padding: 0.75rem 1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.nav-tabs .nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s ease;
}

.nav-tabs .nav-link:hover::before {
    left: 100%;
}

.nav-tabs .nav-link:hover {
    border-color: #007bff #007bff #dee2e6;
    background-color: #e3f2fd;
    color: #0056b3;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,123,255,0.15);
}

.nav-tabs .nav-link.active {
    color: #0056b3;
    background-color: #fff;
    border-color: #007bff #007bff #fff;
    border-bottom-color: transparent;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,123,255,0.1);
}

.nav-tabs {
    border-bottom: 1px solid #dee2e6;
}

.tab-content {
    border: 1px solid #dee2e6;
    border-top: none;
    padding: 1rem;
    background-color: #fff;
    border-radius: 0 0 0.375rem 0.375rem;
    animation: fadeInUp 0.4s ease-out;
}

/* Button Animations */
.btn {
    position: relative;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255,255,255,0.3);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.btn:hover::before {
    width: 300px;
    height: 300px;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Specific Button Colors */
.btn-primary {
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #0056b3, #004085);
    color: white;
}

.btn-danger {
    background: linear-gradient(135deg, #dc3545, #c82333);
    color: white;
}

.btn-danger:hover {
    background: linear-gradient(135deg, #c82333, #a71e2a);
    color: white;
}

.btn-warning {
    background: linear-gradient(135deg, #ffc107, #e0a800);
    color: #212529;
}

.btn-warning:hover {
    background: linear-gradient(135deg, #e0a800, #d39e00);
    color: #212529;
}

.btn-info {
    background: linear-gradient(135deg, #17a2b8, #138496);
    color: white;
}

.btn-info:hover {
    background: linear-gradient(135deg, #138496, #117a8b);
    color: white;
}

.btn-success {
    background: linear-gradient(135deg, #28a745, #1e7e34);
    color: white;
}

.btn-success:hover {
    background: linear-gradient(135deg, #1e7e34, #155724);
    color: white;
}

/* Loading Animation */
.btn-loading {
    pointer-events: none;
    opacity: 0.7;
}

.btn-loading::after {
    content: '';
    position: absolute;
    width: 16px;
    height: 16px;
    margin: auto;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
}

/* Card Animations */
.card {
    transition: all 0.3s ease;
    border: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
}

.card:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    transform: translateY(-2px);
}

.card-header {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-bottom: 1px solid #dee2e6;
}

/* Input Animations */
.form-control {
    transition: all 0.3s ease;
    border: 2px solid #e9ecef;
}

.form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
    transform: scale(1.02);
}

/* Alert Animations */
.alert {
    animation: slideInDown 0.5s ease-out;
}

/* Table Animations */
.table tbody tr {
    transition: all 0.3s ease;
}

.table tbody tr:hover {
    background-color: #f8f9fa;
    transform: scale(1.01);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* Badge Animations */
.badge {
    transition: all 0.3s ease;
    animation: pulse 2s infinite;
}

.badge:hover {
    transform: scale(1.1);
}

/* Icon Animations */
.fas, .far {
    transition: all 0.3s ease;
}

.btn:hover .fas,
.btn:hover .far {
    transform: scale(1.2) rotate(5deg);
}

/* Keyframe Animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInDown {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(0,123,255,0.7);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(0,123,255,0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(0,123,255,0);
    }
}

/* Floating Action Button Effect */
.btn-lg {
    position: relative;
}

.btn-lg::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: inherit;
    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3), transparent 70%);
    transform: translateX(-100%);
    transition: transform 0.6s;
}

.btn-lg:hover::after {
    transform: translateX(100%);
}

/* Ripple Effect */
.ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255,255,255,0.6);
    transform: scale(0);
    animation: ripple-animation 0.6s linear;
    pointer-events: none;
}

@keyframes ripple-animation {
    to {
        transform: scale(4);
        opacity: 0;
    }
}

/* Spinner Animation */
.spinner-border-sm {
    width: 1rem;
    height: 1rem;
    border-width: 0.15em;
}

/* Responsive Animations */
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}
</style>

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4 text-center"><i class="fas fa-crown text-warning"></i> NEXUS Yönetim Paneli</h1>
    
    <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> Hoş geldin <b>{{ user.username }}</b>!<br>
        Bu panelden sadece NEXUS kullanıcısı erişebilir ve site için kritik ayarları yönetebilir.
    </div>
    
    {% if message %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle"></i> {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}

    <!-- Tab Navigation -->
    <nav>
        <div class="nav nav-tabs mb-3" id="adminTabs" role="tablist">
            <button class="nav-link active" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab" aria-controls="settings" aria-selected="true">
                <i class="fas fa-cog me-2"></i>Site Ayarları
            </button>
            <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab" aria-controls="users" aria-selected="false">
                <i class="fas fa-users me-2"></i>Kullanıcı Yönetimi
            </button>
            <button class="nav-link" id="devices-tab" data-bs-toggle="tab" data-bs-target="#devices" type="button" role="tab" aria-controls="devices" aria-selected="false">
                <i class="fas fa-mobile-alt me-2"></i>Cihaz Yönetimi
            </button>
        </div>
    </nav>

    <!-- Tab Content -->
    <div class="tab-content" id="adminTabsContent">
        
        <!-- Site Ayarları Tab -->
        <div class="tab-pane fade show active" id="settings" role="tabpanel" aria-labelledby="settings-tab">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-cog"></i> Kritik Site Ayarları</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="maintenance_mode" name="maintenance_mode" {% if maintenance_mode %}checked{% endif %}>
                                    <label class="form-check-label" for="maintenance_mode">
                                        <i class="fas fa-tools"></i> Bakım Modu Aktif
                                    </label>
                                    <small class="form-text text-muted">Aktif olduğunda sadece NEXUS erişebilir</small>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="registration_open" name="registration_open" {% if registration_open %}checked{% endif %}>
                                    <label class="form-check-label" for="registration_open">
                                        <i class="fas fa-user-plus"></i> Kayıt Açık
                                    </label>
                                    <small class="form-text text-muted">Yeni kullanıcı kayıtlarını kontrol eder</small>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="site_password" class="form-label">
                                        <i class="fas fa-key"></i> Site Giriş Şifresi:
                                    </label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="site_password" name="site_password" value="{{ site_password }}" placeholder="Site şifresi">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('site_password')">
                                            <i class="fas fa-eye" id="site_password_eye"></i>
                                        </button>
                                    </div>
                                    <small class="form-text text-muted">Kullanıcıların siteye erişimi için gerekli şifre</small>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save"></i> Ayarları Kaydet
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Kullanıcı Yönetimi Tab -->
        <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5><i class="fas fa-users"></i> Kullanıcı Bilgileri</h5>
                    <button class="btn btn-info btn-sm" onclick="loadAllUsers()">
                        <i class="fas fa-refresh"></i> Tüm Kullanıcıları Listele
                    </button>
                </div>
                <div class="card-body">
                    <!-- Tekil Kullanıcı Sorgulama -->
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchUsername" placeholder="Kullanıcı adı girin...">
                                <button class="btn btn-outline-primary" onclick="searchUser()">
                                    <i class="fas fa-search"></i> Kullanıcı Ara
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Kullanıcı Bilgileri Sonuç Alanı -->
                    <div id="userSearchResult"></div>
                    
                    <!-- Tüm Kullanıcılar Tablosu -->
                    <div id="allUsersTable" style="display: none;">
                        <h6>Tüm Kullanıcılar:</h6>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Kullanıcı Adı</th>
                                        <th>Rol</th>
                                        <th>Durum</th>
                                        <th>Son Giriş</th>
                                        <th>Cihaz Token</th>
                                        <th>Aktif Oturum</th>
                                        <th>İşlemler</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cihaz Yönetimi Tab -->
        <div class="tab-pane fade" id="devices" role="tabpanel" aria-labelledby="devices-tab">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-mobile-alt"></i> Cihaz Token Yönetimi</h5>
                </div>
                <div class="card-body">
                    <!-- Tekil Cihaz Sıfırlama -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6><i class="fas fa-user"></i> Tekil Kullanıcı Cihaz Sıfırlama</h6>
                            <form id="resetDeviceForm" class="mb-3">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="resetUsername" placeholder="Kullanıcı adı" required>
                                    <button type="submit" class="btn btn-warning">
                                        <i class="fas fa-redo"></i> Cihazı Sıfırla
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="col-md-6">
                            <h6><i class="fas fa-exclamation-triangle"></i> Toplu İşlemler</h6>
                            <div class="d-grid gap-2">
                                <button class="btn btn-danger" onclick="resetAllDevices()">
                                    <i class="fas fa-exclamation-triangle"></i> TÜM Cihazları Sıfırla
                                </button>
                                <button class="btn btn-warning" onclick="resetNexusRyderDevices()">
                                    <i class="fas fa-crown"></i> NEXUS & RYDER Cihazlarını Sıfırla
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sonuç Alanı -->
                    <div id="deviceResetResult"></div>
                    
                    <!-- Uyarı -->
                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle"></i> <strong>Dikkat:</strong> 
                        Cihaz sıfırlama işlemi kullanıcıları sistemden çıkış yapmaya zorlar ve yeniden giriş yapmalarını gerektirir.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Şifre görünürlüğü toggle
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const eye = document.getElementById(fieldId + '_eye');
    
    if (field.type === 'password') {
        field.type = 'text';
        eye.className = 'fas fa-eye-slash';
    } else {
        field.type = 'password';
        eye.className = 'fas fa-eye';
    }
}

// Loading animasyonu ekle/kaldır
function addLoadingAnimation(buttonElement, originalText) {
    buttonElement.classList.add('btn-loading');
    buttonElement.disabled = true;
    buttonElement.innerHTML = `<span class="spinner-border spinner-border-sm me-2" role="status"></span>Yükleniyor...`;
}

function removeLoadingAnimation(buttonElement, originalText) {
    buttonElement.classList.remove('btn-loading');
    buttonElement.disabled = false;
    buttonElement.innerHTML = originalText;
}

// Buton tıklama efekti
function addClickEffect(event) {
    const button = event.target.closest('.btn');
    if (!button) return;
    
    const ripple = document.createElement('span');
    const rect = button.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    const x = event.clientX - rect.left - size / 2;
    const y = event.clientY - rect.top - size / 2;
    
    ripple.style.width = ripple.style.height = size + 'px';
    ripple.style.left = x + 'px';
    ripple.style.top = y + 'px';
    ripple.classList.add('ripple');
    
    button.appendChild(ripple);
    
    setTimeout(() => {
        ripple.remove();
    }, 600);
}

// Tüm butonlara tıklama efekti ekle
document.addEventListener('click', addClickEffect);

// Kullanıcı arama
function searchUser() {
    const username = document.getElementById('searchUsername').value.trim();
    const searchBtn = document.querySelector('button[onclick="searchUser()"]');
    const originalText = searchBtn.innerHTML;
    
    if (!username) {
        showAlert('userSearchResult', 'Lütfen bir kullanıcı adı girin.', 'warning');
        return;
    }
    
    addLoadingAnimation(searchBtn, originalText);
    
    fetch(`/admin/get_user_info/${username}`)
        .then(r => r.json())
        .then(data => {
            removeLoadingAnimation(searchBtn, originalText);
            if (data.success) {
                displayUserInfo(data.user);
            } else {
                showAlert('userSearchResult', data.error, 'danger');
            }
        })
        .catch(err => {
            removeLoadingAnimation(searchBtn, originalText);
            showAlert('userSearchResult', 'Bir hata oluştu.', 'danger');
        });
}

// Kullanıcı bilgilerini göster
function displayUserInfo(user) {
    const statusBadge = user.is_banned ? '<span class="badge bg-danger">Yasaklı</span>' : 
                       user.is_muted ? '<span class="badge bg-warning">Susturulmuş</span>' : 
                       '<span class="badge bg-success">Aktif</span>';
    
    const html = `
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-user"></i> ${user.username} - Kullanıcı Detayları</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>ID:</strong> ${user.id}</p>
                        <p><strong>Rol:</strong> <span class="badge bg-primary">${user.role}</span></p>
                        <p><strong>Durum:</strong> ${statusBadge}</p>
                        <p><strong>Tema:</strong> ${user.theme}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Son Giriş:</strong> ${user.last_login}</p>
                        <p><strong>Son IP:</strong> ${user.last_ip}</p>
                        <p><strong>Cihaz Token:</strong> <span class="badge ${user.device_token === 'Var' ? 'bg-success' : 'bg-secondary'}">${user.device_token}</span></p>
                        <p><strong>Aktif Oturum:</strong> <span class="badge bg-info">${user.active_sessions}</span></p>
                    </div>
                </div>
                <button class="btn btn-warning btn-sm" onclick="resetUserDevice('${user.username}')">
                    <i class="fas fa-redo"></i> Bu Kullanıcının Cihazını Sıfırla
                </button>
            </div>
        </div>
    `;
    
    document.getElementById('userSearchResult').innerHTML = html;
}

// Tüm kullanıcıları yükle
function loadAllUsers() {
    const loadBtn = document.querySelector('button[onclick="loadAllUsers()"]');
    const originalText = loadBtn.innerHTML;
    
    addLoadingAnimation(loadBtn, originalText);
    
    fetch('/admin/get_all_users')
        .then(r => r.json())
        .then(data => {
            removeLoadingAnimation(loadBtn, originalText);
            if (data.success) {
                displayAllUsers(data.users);
            } else {
                showAlert('userSearchResult', data.error, 'danger');
            }
        })
        .catch(err => {
            removeLoadingAnimation(loadBtn, originalText);
            showAlert('userSearchResult', 'Bir hata oluştu.', 'danger');
        });
}

// Tüm kullanıcıları tablo halinde göster
function displayAllUsers(users) {
    const tbody = document.getElementById('usersTableBody');
    tbody.innerHTML = '';
    
    users.forEach(user => {
        const statusBadge = user.is_banned ? '<span class="badge bg-danger">Yasaklı</span>' : 
                           user.is_muted ? '<span class="badge bg-warning">Susturulmuş</span>' : 
                           '<span class="badge bg-success">Aktif</span>';
        
        const row = `
            <tr>
                <td>${user.id}</td>
                <td><strong>${user.username}</strong></td>
                <td><span class="badge bg-primary">${user.role}</span></td>
                <td>${statusBadge}</td>
                <td><small>${user.last_login}</small></td>
                <td><span class="badge ${user.device_token === 'Var' ? 'bg-success' : 'bg-secondary'}">${user.device_token}</span></td>
                <td><span class="badge bg-info">${user.active_sessions}</span></td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="resetUserDevice('${user.username}')">
                        <i class="fas fa-redo"></i>
                    </button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
    
    document.getElementById('allUsersTable').style.display = 'block';
}

// Tekil kullanıcı cihaz sıfırlama
function resetUserDevice(username) {
    if (!confirm(`${username} kullanıcısının cihaz kaydını sıfırlamak istediğinizden emin misiniz?`)) {
        return;
    }
    
    // Buton referansını bul (table içindeki veya form'daki)
    const resetBtn = event ? event.target.closest('.btn') : document.querySelector('button[type="submit"]');
    const originalText = resetBtn ? resetBtn.innerHTML : '';
    
    if (resetBtn) {
        addLoadingAnimation(resetBtn, originalText);
    }
    
    fetch(`/admin/reset_device_token/${username}`, {
        method: 'POST',
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(r => r.json())
    .then(data => {
        if (resetBtn) {
            removeLoadingAnimation(resetBtn, originalText);
        }
        if (data.success) {
            showAlert('deviceResetResult', data.message, 'success');
            // Kullanıcı listesini güncelle
            if (document.getElementById('allUsersTable').style.display !== 'none') {
                loadAllUsers();
            }
        } else {
            showAlert('deviceResetResult', data.error, 'danger');
        }
    })
    .catch(err => {
        if (resetBtn) {
            removeLoadingAnimation(resetBtn, originalText);
        }
        showAlert('deviceResetResult', 'Bir hata oluştu.', 'danger');
    });
}

// Tüm cihazları sıfırla
function resetAllDevices() {
    if (!confirm('TÜM kullanıcıların cihaz kayıtlarını sıfırlamak istediğinizden emin misiniz? Bu işlem geri alınamaz!')) {
        return;
    }
    
    const resetBtn = document.querySelector('button[onclick="resetAllDevices()"]');
    const originalText = resetBtn.innerHTML;
    
    addLoadingAnimation(resetBtn, originalText);
    
    fetch('/admin/reset_all_device_tokens', {
        method: 'POST',
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(r => r.json())
    .then(data => {
        removeLoadingAnimation(resetBtn, originalText);
        if (data.success) {
            showAlert('deviceResetResult', data.message, 'success');
        } else {
            showAlert('deviceResetResult', data.error, 'danger');
        }
    })
    .catch(err => {
        removeLoadingAnimation(resetBtn, originalText);
        showAlert('deviceResetResult', 'Bir hata oluştu.', 'danger');
    });
}

// NEXUS & RYDER cihazlarını sıfırla
function resetNexusRyderDevices() {
    if (!confirm('NEXUS ve RYDER kullanıcılarının cihaz kayıtlarını sıfırlamak istediğinizden emin misiniz?')) {
        return;
    }
    
    const resetBtn = document.querySelector('button[onclick="resetNexusRyderDevices()"]');
    const originalText = resetBtn.innerHTML;
    
    addLoadingAnimation(resetBtn, originalText);
    
    fetch('/admin/reset_nexus_ryder_device_tokens', {
        method: 'POST',
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(r => r.json())
    .then(data => {
        removeLoadingAnimation(resetBtn, originalText);
        if (data.success) {
            showAlert('deviceResetResult', data.message, 'success');
        } else {
            showAlert('deviceResetResult', data.error, 'danger');
        }
    })
    .catch(err => {
        removeLoadingAnimation(resetBtn, originalText);
        showAlert('deviceResetResult', 'Bir hata oluştu.', 'danger');
    });
}

// Alert gösterme fonksiyonu
function showAlert(containerId, message, type) {
    const alertHtml = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'exclamation-circle'}"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
    document.getElementById(containerId).innerHTML = alertHtml;
}

// Form submit events
document.getElementById('resetDeviceForm').onsubmit = function(e) {
    e.preventDefault();
    const username = document.getElementById('resetUsername').value.trim();
    if (!username) {
        showAlert('deviceResetResult', 'Lütfen bir kullanıcı adı girin.', 'warning');
        return;
    }
    resetUserDevice(username);
    document.getElementById('resetUsername').value = '';
};

// Enter tuşu ile arama
document.getElementById('searchUsername').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchUser();
    }
});
</script>
{% endblock %}